const grabTableData = require('./grabTableData')

test('Removes any lines before table', () => {
  const output = `console.debug src/image_manager.js:785
image replaced:DOC_BACKGROUND
console.debug src/image_manager.js:785
image replaced:DOC_BACKGROUND
-----------------------------------------------------------------|----------|----------|----------|----------|-------------------|
File                                                             |  % Stmts | % Branch |  % Funcs |  % Lines | Uncovered Line #s |
-----------------------------------------------------------------|----------|----------|----------|----------|-------------------|
All files                                                        |    45.49 |    34.75 |    53.71 |    45.23 |                   |
 src                                                             |     62.9 |    49.52 |    60.49 |    63.02 |                   |
  app.js                                                         |    55.97 |       37 |    41.18 |    57.05 |... 62,364,366,368 |
  app_history.js                                                 |    57.29 |    50.58 |    84.62 |    57.37 |... 80,382,384,385 |
-----------------------------------------------------------------|----------|----------|----------|----------|-------------------|
`
  const table = grabTableData(output)
  expect(table.join('\n'))
    .toEqual(`File                                                             |  % Stmts | % Branch |  % Funcs |  % Lines | Uncovered Line #s |
-----------------------------------------------------------------|----------|----------|----------|----------|-------------------|
All files                                                        |    45.49 |    34.75 |    53.71 |    45.23 |                   |
 src                                                             |     62.9 |    49.52 |    60.49 |    63.02 |                   |
  app.js                                                         |    55.97 |       37 |    41.18 |    57.05 |... 62,364,366,368 |
  app_history.js                                                 |    57.29 |    50.58 |    84.62 |    57.37 |... 80,382,384,385 |`)
})

test('Removes any command lines before table', () => {
  const output = `>console.debug src/image_manager.js:785
>image replaced:DOC_BACKGROUND
>console.debug src/image_manager.js:785
>image replaced:DOC_BACKGROUND
-----------------------------------------------------------------|----------|----------|----------|----------|-------------------|
File                                                             |  % Stmts | % Branch |  % Funcs |  % Lines | Uncovered Line #s |
-----------------------------------------------------------------|----------|----------|----------|----------|-------------------|
All files                                                        |    45.49 |    34.75 |    53.71 |    45.23 |                   |
 src                                                             |     62.9 |    49.52 |    60.49 |    63.02 |                   |
  app.js                                                         |    55.97 |       37 |    41.18 |    57.05 |... 62,364,366,368 |
  app_history.js                                                 |    57.29 |    50.58 |    84.62 |    57.37 |... 80,382,384,385 |
-----------------------------------------------------------------|----------|----------|----------|----------|-------------------|
`
  const table = grabTableData(output)
  expect(table.join('\n'))
    .toEqual(`File                                                             |  % Stmts | % Branch |  % Funcs |  % Lines | Uncovered Line #s |
-----------------------------------------------------------------|----------|----------|----------|----------|-------------------|
All files                                                        |    45.49 |    34.75 |    53.71 |    45.23 |                   |
 src                                                             |     62.9 |    49.52 |    60.49 |    63.02 |                   |
  app.js                                                         |    55.97 |       37 |    41.18 |    57.05 |... 62,364,366,368 |
  app_history.js                                                 |    57.29 |    50.58 |    84.62 |    57.37 |... 80,382,384,385 |`)
})

test("Don't remove last line if not ----|", () => {
  const output = `console.debug src/image_manager.js:785
image replaced:DOC_BACKGROUND
console.debug src/image_manager.js:785
image replaced:DOC_BACKGROUND

-----------------------------------------------------------------|----------|----------|----------|----------|-------------------|
File                                                             |  % Stmts | % Branch |  % Funcs |  % Lines | Uncovered Line #s |
-----------------------------------------------------------------|----------|----------|----------|----------|-------------------|
All files                                                        |    45.49 |    34.75 |    53.71 |    45.23 |                   |
  src                                                             |     62.9 |    49.52 |    60.49 |    63.02 |                   |
    app.js                                                         |    55.97 |       37 |    41.18 |    57.05 |... 62,364,366,368 |
    app_history.js                                                 |    57.29 |    50.58 |    84.62 |    57.37 |... 80,382,384,385 |`
  const table = grabTableData(output)
  expect(table.join('\n'))
    .toEqual(`File                                                             |  % Stmts | % Branch |  % Funcs |  % Lines | Uncovered Line #s |
-----------------------------------------------------------------|----------|----------|----------|----------|-------------------|
All files                                                        |    45.49 |    34.75 |    53.71 |    45.23 |                   |
  src                                                             |     62.9 |    49.52 |    60.49 |    63.02 |                   |
    app.js                                                         |    55.97 |       37 |    41.18 |    57.05 |... 62,364,366,368 |
    app_history.js                                                 |    57.29 |    50.58 |    84.62 |    57.37 |... 80,382,384,385 |`)
})
